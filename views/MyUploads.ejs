<%- include ("includes/header", {
    "title": "My Uploads"
}) %>

<div class="container" style="margin-top: 50px; margin-bottom: 50px;">
    <%- include ("includes/ResponseAlert", {
        "request": request
    }) %>

    <div class="row">
        <div class="col-md-4">
            <h1>
                <% if (folderName == "") { %>
                My Uploads
                <% } else { %>
                <%= folderName %>
                <% } %>
            </h1>
        </div>

        <% if (createdAt != "") { %>
        <div class = col-md-4>
            Created at: 
            <% 
            createdAt = new Date(createdAt);
            createdAt = createdAt.getDate() + " " + months[createdAt.getMonth()] + ", " + createdAt.getFullYear() + " " + createdAt.getHours() + ":" + createdAt.getMinutes() + ":" + createdAt.getSeconds();
            %>

            <%= createdAt %>

        </div>
        <% } %>

        <div class="col-md-4">

            <a href="#" id="open-file-uploader" class="btn btn-primary" on click="selectFileForUpload();">Upload</a>

            <button type="button" class="btn btn-primary" onClick="onClickCreateFolder();">Create folder</button>
        </div>
    </div>

    <div class = "row">
        <%
        uploaded.forEach(function(singleFile) {

            var fileSize = 0;
            %>
            <div class = "card">
                <div class = "card-body" style="font-size: 100px; text-align: center; height: 300px;">
                <% if (singleFile.type == "folder") { %>
                <i class = "fa fa-folder-open-o"></i>
                <% } else { %>
                    <i class="fa fa-file-text-o"></i>
                    <% } %>
                </div>

                <div class="card-footer">
                    <div class="row">
                        <div class="col-md-8">
                           <% if(singleFile.type == "folder") {
                               fileSize = getFolderSize(singleFile.files);
                               fileSize = formatBytes(fileSize);
                               %>
                               <h3>
                                   <a href="<%= request.mainURL + '/MyUploads/' +singleFile._id %>">
                                   <%= singleFile.folderName.substring(0,10) %>

                                   <%= (singleFile.folderName.length > 10) ? "..." : "" %>
                                   </a>
                               </h3>
                            <% } else {
                                fileSize = formatBytes(singleFile.size);
                                %>
                                <h3>
                                    <%= singleFile.name.substring(0,10) %>

                                    <%= (singleFile.name.length > 10) ? "..." : "" %>
                                </h3>
                                <% } %>
                        </div>

                        <div class="col-md-4">
                            <p style="position: relative; top: 10px;"><%= fileSize %>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <% }) %>
    </div>


<form method="POST" action="<%= request.mainURL %>/CreateFolder" id = "form-create-folder">
    <input type="hidden" name= "name" required />
    <input type="hidden" name="_id" value="<%= _id %>" />
</form>

<form method="POST" action="<%= request.mainURL %>/UploadFile" enctype="multipart/form-data" id="form-upload-file">
    <input type="hidden" name= "_id" value="<%= _id %>" />
    <input type="file" name="file" id="input-file-upload" style="position: relative;
     overflow: hidden; top: -1000px;" onchange="confirmUpload();" required />
</form>

<script>

    function confirmUpload() {
        if (confirm ("Upload the selected file to the server ?")) {
            document.getElementById("form-upload-file").submit();
        }
    }

    function selectFileForUpload() {
        const aTag = document.getElementById("open-file-uploader");
        const fileInput = document.getElementById("input-file-upload");
        aTag.addEventListener("click", () => fileInput.click());
        // ("#upload_link").on('click', function(e){
        // e.preventDefault();
        // ("#upload:hidden").trigger('click');
        // });
    }

    function onClickCreateFolder() {
        var folderName = prompt("Please enter folder name", "");

        if(folderName != null) {
            document.getElementById("form-create-folder").name.value = folderName;
            document.getElementById("form-create-folder").submit();
        }
    }
</script>
<%- include("includes/footer") %>